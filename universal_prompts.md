# 万能プロンプト集

このファイルは、2値ラベル系（ベイズ、サンプリング、検定など）の問題を最短で解くためのLLM用プロンプトテンプレートです。
コピーしてChatGPT/Claude等のAIアシスタントに入力することで、標準化された解答手順を得ることができます。

---

## (A) 問題文整形テンプレ（画像/乱文→「与件の型」に落とす）

```text
# 役割：問題文を「解ける形」に整形してから、最短の立式ルートを提示して

次の入力（問題文・画像の内容）を、解答前の「整形」だけやって。
目的は、後でそのまま解答に突っ込める“与件の型”を作ること。

制約：
- 測度論の用語は禁止。
- 記号は最小限、短く。未定義の記号を勝手に増やさない。
- まず日本語→記号対応を明記（後で焼き付けるため）。
- 離散/連続を明示し、離散なら和、連続なら積分、どっちで行くかを1行で宣言。
- 仮定（独立、同分布、等確率抽出、条件付き…）は「問題文のどこを根拠にしたか」も1行で添える。
- まだ計算はしない。式の骨組みまで。

出力フォーマット（この順で）：
(0) 問題文の要約（1〜3行）
(1) 変数・パラメータ一覧（記号 / 意味 / 取り得る値・範囲 / 離散or連続）
(2) 求める量（=出力）を1行で： P( ), E[ ], Var[ ], 推定量, etc
(3) 重要な前提・条件（箇条書き、根拠も併記）
(4) “型”宣言：和/積分/条件付き更新/最尤/共分散補正…どれを主軸にするか
(5) 最短の立式ルート（3〜6行）：どの恒等式・公式をどこで使うかだけ
(6) 使う記号の最終固定（表）：これ以降ブレない形にする

入力（そのまま貼る）：
<<<
ここに問題文テキスト or 画像の内容（OCRでも雑でOK）
>>>
```

---

## (B) 万能解答テンプレ（離散/連続どっちも対応、PBT写経＋CBT符号化）

```text
# 役割：下の「整形済み与件」を使って、PBT答案とCBT最短メモを両方出して

次の「整形済み与件」を前提に、(1)PBT写経用の厳密答案 と (2)CBT用の最短符号化メモ を両方出して。

制約：
- 測度論の用語は禁止。
- 記号は「整形済み与件」で固定。勝手に改名しない。
- “どの与件を使ったからこの式になるか”を、式の直前に1行で必ず書く（PBT側）。
- 離散なら Σ、連続なら ∫。混ぜない。先に宣言。
- 条件付き（|）や積集合(∩)は、混乱防止のために使う流儀を統一（必要なら全部∩で書く）。
- 最終結果は数値 or 1行の閉形式で必ず出す。

出力フォーマット：
A) PBT答案（写経用：省略しないが冗長にしない）
  A0. 型宣言（和or積分 / 何をEと置くか）
  A1. 入力→出力→型→式（フレームワークで1ブロック）
  A2. 定義（必要ならΩ/Eや、連続なら範囲・密度）
  A3. 立式（与件のどこを使ったか明記しながら）
  A4. 計算（要所だけ）
  A5. 結論（答え）

B) CBT最短メモ（紙に吐く符号化）
  (E) 何を観測/条件/事象にしたか
  (A)(B)… 最小の中間量（分子/分母、または比 m だけ）
  (Ans) 入力する答え（数値）
  ※ “電卓メモリ感”で、括弧ラベルを付けて短く。

C) 暗記用1行（最終形だけ）
  - その問題タイプの最短恒等式（1行）

整形済み与件：
<<<
(A)の出力をここに貼る
>>>
```

---

## (C) 統合型万能プロンプト（これ1本だけで回す）

```text
# 役割：問題文が雑でも画像でもOK。まず「整形（与件の型）」を作り、次に PBT答案と CBT最短メモを同時に出す。
# 目的：最短合格サイクル（演習回転）を最大化。必ず「どの与件を使ったからその式になるか」を明記。
# 禁止：測度論用語（測度・可測・逆像・σ-代数など）。カンマで同時事象を書く流儀は禁止（∩で統一）。
# 記号：短く、最小限。未定義の新記号を勝手に増やさない。必要なら「ここで定義する」と明示してから使う。
# 注意：問題文の条件（独立/iid/等確率抽出/復元or非復元/条件付き）を勝手に仮定しない。根拠行を添える。
# 出力：A)整形→B)PBT→C)CBT→D)暗記1行→E)自己検算→F)次の周回の指示

========================
【INPUT】問題文（そのまま貼る）
========================
<<<
（ここに問題文テキスト。画像OCRの雑文でも可。設問が複数なら[1][2]...と区切って貼る）
>>>

========================
【OPTION】希望（空でもOK）
========================
- 試験形式：CBT重視 / PBT重視 / 両方（デフォルト=両方）
- 記号の好み：∩統一（デフォルト）/ ,も許容
- 使ってよい道具：共分散OK / 分布名（超幾何など）OKだが丸暗記禁止 / 最尤OK / 微積OK
- 出力の粒度：最短 / 標準（デフォルト）/ 丁寧

========================
【OUTPUT】この順番で必ず出力
========================

A) 整形（与件の型：解く前の準備）
A0. 要約（1〜3行）
A1. 変数・パラメータ表（記号 / 意味 / 値域 / 離散or連続）
A2. 求める量（出力）を1行で：P( ), E[ ], Var[ ], 推定量, etc
A3. 前提・条件（箇条書き）
    - 各前提の根拠：問題文の該当箇所（引用は短く）
A4. 型宣言（どの型で行くか）
    - 離散→Σ / 連続→∫ / 抽出→共分散補正 / ベイズ→E差し替え / 推定→尤度 or モーメント
A5. 最短ルート（3〜8行）
    - 使う恒等式・定義を列挙（例：全確率、条件付き、共分散分解、Var(Σ)=ΣVar+2ΣCov、など）
A6. 記号固定（以後ブレない一覧）
    - 「この記号以外は増やさない」を宣言

B) PBT答案（写経用：採点者に通るが冗長すぎない）
B0. 入力→出力→型→式（フレーム）
    - 入力：与件
    - 出力：求める量
    - 型：Σ/∫/共分散/尤度 など
    - 式：最初の一手（定義式）
B1. 立式（ここが重要）
    - 各式の直前に必ず1行：
      「（与件のどこ）を使う → この式」
    - 同時事象は ∩ を使う（カンマ禁止）
B2. 計算（必要十分）
    - 途中式は“要所のみ”
    - 係数の書き落としを避ける（事前/重み/標本化係数など）
B3. 結論（答え）
    - 数値なら数値、式なら閉形式
    - 設問が複数なら[1][2]…ごとにまとめる

C) CBT最短メモ（紙に吐く符号化：自分用）
※ PBTで確立した骨格を、最短で再現する符号化のみを書く。

共通テンプレ：
(Ω) 1行だけ（登場人物整列。不要なら省略可）
(E) 求めるイベント/条件（差し替え点）
(与件) 必要な与件だけ抜粋（数値・確率・範囲）
(A)(B) または (m) の最短中間量
(Ans) 入力する答え（数値 or 最終式）

指針：
- 分母を作る途中で分子が出るなら流用
- 比 m が作れるなら 1/(1+m) に落とす
- 係数（重み）は必ず(A)(B)に吸収して書き落とし防止

D) 暗記1行（この問題タイプの最短恒等式）
- 例：Var(Σ)=ΣVar+2ΣCov
- 例：P(d|E)=A/(A+B)=1/(1+m)
- 例：P(E)=Σ P(E|d)P(d)
（その問題に最適な1行を選んで提示）

E) 自己検算（30秒でできるチェックだけ）
- 範囲チェック（確率は0〜1、分散は≥0）
- 極限チェック（例：復元抽出に近づくと補正が消える、など）
- 次元チェック（単位の整合）
- 設問条件の再確認（独立と書いてないのに独立扱いしてないか、など）

F) 次の周回の指示（演習を速く回すため）
- 「この問題の型は○○」とタグ付け
- 「次に同型を2問解くなら、E差し替えはここ／係数はここ」など最短の注意点を2行
- もし詰まりが出るなら、どの式のどの行を再質問すべきか（ピンポイント質問文）を1個出す
```

---

## (D) 事例辞典の台帳運用（Stage1/Stage2の機械化）

この節は、**「問＋答セット」を機械的に整理して Part IV（事例辞典）へ流し込む**ための運用手順です。  
目的は「他チャットに溜まった問題群を、検索→台帳化→ページ化の流れでさばく」ことに特化させること。

### 1) Stage1（台帳）を作る：最小4行テンプレ

問＋答が揃っている話題は、以下の4行だけで索引化できます。  
※余計な解説は不要。**答の最終形と記号辞書だけ**を書けばOK。

```text
[Title] ・・・（短い名前）
[Q]     ・・・（何を出す？ P( ) / Var( ) / 事後 / 検定量 など）
[A]     ・・・（最終式の形。例：1-Φ((c-μ)/σ)）
[Given] ・・・（記号辞書：p,t,f / n,N / μ,σ など）
```

必要なときだけ、仮定を1語で追加：

```text
[Assume] indep / dep / markov / mix / normal / linear
```

### 2) 台帳ファイル（iv_manifest.tsv）形式

Stage1で集めた要素を「1行=1問題」で保存する。  
**タブ区切りTSV**が運用しやすい（追記が速い）。

```tsv
id	title	dom	obj	shape	etype	dec	dep	tool	src	q	a	given	assume
IV-A-001	単発陽性→感染事後	dom/prob	obj/post	shape/latent_obs	single	sum_partition	indep	update_q	感染症Q1	"P(H|E)"	"(t p)/(t p+f p̄)"	"p,t,f"	"indep"
```

#### 主要列の意味（最小限）

- `dom`：分野（prob/stat/ts/ml/la など）
- `obj`：出力（post/prob/var/cov/test/est/cls/compare）
- `shape`：型（latent_obs / sampling / standardize / sequence / estimation / hypothesis / geometry）
- `etype`：Eの形（single / intersection / threshold / count_k / sequence / none）
- `dec`：分解（sum_partition / prod_step / both / none）
- `dep`：依存性（indep / dep / markov / mix / none）
- `tool`：道具（update_q / cov_expand / zscore / likelihood / chi_square など）

### 3) Stage2（ページ雛形）の自動生成

台帳から、**Part IV の雛形ページを自動生成**する。  
ここでは「本文の埋め込み」は後回しで良い。

#### 出力の固定フォーム（1ページ分）

```text
# Title

## Tags
- dom/...
- obj/...
- shape/...
- etype/...
- dec/...
- dep/...
- tool/...

## Spec
（Ω, H, O_i, T を最小宣言）

## Query
問：...
求：...

## E（事象）
E := ...（intersection/sequence は左=新、右=旧）

## Given
記号辞書（Given）＋仮定（Assume）

## Decompose
Σ / ∏ / 両方の宣言

## Compute
最終式（台帳のAを写経）

## Check
1行検算（極限/範囲/単位）
```

### 4) 判別ルール（問＋答から dom/obj/shape を決める）

**答の形だけでほぼ決まる**ので、機械化しやすい。

- 分数 `A/(A+B)` → obj/post（事後）  
- `1-Φ(…)` → obj/prob + shape/standardize  
- `Var(Σ)=ΣVar+2ΣCov` → obj/var + shape/sampling + tool/cov_expand  
- `χ², p値, df` → obj/test + shape/hypothesis  
- `argmax, logL, score` → obj/est + shape/estimation  
- `距離, 境界, sign` → obj/compare/cls + shape/geometry  

### 5) チャット検索で拾う運用（機械化の流れ）

1. **検索で「問＋答が揃ってる」話題だけ拾う**  
2. Stage1テンプレで4行化  
3. `iv_manifest.tsv` に追記  
4. 不足（TBD）は lint で炙る  
5. 追記 → 雛形生成 → まとめて埋める  

> 重要：台帳が「真実の源」になる。本文生成は必ず台帳から作る。

### 6) TBD回収用プロンプト（コピペ用）

「該当チャットに戻って最終式だけ拾う」ための最短テンプレ：

```text
【目的】iv_manifest.tsv のTBD行を埋めるため、最終式aと記号辞書givenだけ回収する。
【制約】余計な解説は禁止。式と定義だけ。
【記号憲法】Ω、H、O_i、E、q。逐次は E_{1:i}:=E_i∩…∩E_1（左=新、右=旧）。p̄=1-p。
【出力】次の4行だけ：
q: ...
a: ...
given: ...
assume: ...
```

---
